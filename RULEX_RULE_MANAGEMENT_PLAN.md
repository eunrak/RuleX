# RuleX - 규칙 관리 시스템 설계 계획

## 🎯 비전
**RuleX**: 정책 문서를 기반으로 실시간 모니터링 규칙을 자동 생성하고 유지보수하는 AI 기반 플랫폼

---

## 📋 핵심 기능 아키텍처

### 1. 규칙 생성 (Rule Creation)

#### 1.1 자동 규칙 생성
**트리거 방식:**
- 정책 문서 업로드 시 자동 분석
- AI가 문서 내용을 파싱하여 모니터링 가능한 규정 추출
- 사용자 승인 후 규칙 활성화

**생성 프로세스:**
```
1. 정책 문서 업로드
   ↓
2. AI 분석 (NLP)
   - 규정 조항 추출
   - 모니터링 가능 여부 판단
   - 위반 조건 식별
   ↓
3. 규칙 제안
   - 규칙명 자동 생성
   - SQL/쿼리 자동 생성
   - 심각도 수준 제안
   - 알림 주기 제안
   ↓
4. 사용자 검토 및 승인
   ↓
5. 규칙 활성화
```

**예시:**
- **정책**: "직원은 90일마다 비밀번호를 변경해야 한다"
- **자동 생성 규칙**:
  - 이름: "비밀번호 90일 미변경 감지"
  - 쿼리: `SELECT user_id, last_password_change FROM users WHERE DATEDIFF(NOW(), last_password_change) > 90`
  - 심각도: High
  - 스케줄: 매일 09:00

#### 1.2 수동 규칙 생성
**대화형 생성:**
- 자연어로 규칙 설명
- AI가 SQL/쿼리 자동 생성
- 실시간 미리보기 및 테스트

**UI 구성:**
```
[규칙 생성 마법사]
1단계: 기반 정책 선택
2단계: 모니터링 대상 DB/소스 선택
3단계: 위반 조건 정의 (자연어 또는 쿼리)
4단계: 심각도 및 알림 설정
5단계: 테스트 실행
6단계: 규칙 저장 및 활성화
```

---

### 2. 규칙 유지보수 (Rule Maintenance)

#### 2.1 자동 업데이트
**정책 변경 감지:**
- 정책 문서 버전 업데이트 시 관련 규칙 자동 식별
- 변경 사항 분석 후 규칙 수정안 제안
- 승인 후 자동 적용

**예시:**
```
정책 변경: 비밀번호 변경 주기 90일 → 60일
         ↓
관련 규칙 자동 탐지: "비밀번호 90일 미변경 감지"
         ↓
수정안 제안:
  - 규칙명: "비밀번호 60일 미변경 감지"
  - 쿼리: DATEDIFF(NOW(), last_password_change) > 60
         ↓
사용자 승인
         ↓
자동 업데이트 완료
```

#### 2.2 규칙 성능 모니터링
**메트릭 추적:**
- 실행 빈도 및 소요 시간
- 탐지된 위반 건수
- False Positive 비율
- 리소스 사용량

**자동 최적화:**
- 쿼리 성능 분석
- 인덱스 제안
- 스케줄 조정 제안

#### 2.3 규칙 라이프사이클 관리
**상태 관리:**
- Active (활성)
- Paused (일시중지)
- Archived (보관)
- Deprecated (폐기)

**자동 폐기 제안:**
- 6개월간 위반 0건 → 검토 제안
- 기반 정책 폐기됨 → 자동 폐기
- 중복 규칙 탐지 → 병합 제안

---

### 3. 규칙 관리 UI 개선안

#### 3.1 규칙 대시보드
```
┌─────────────────────────────────────────┐
│  규칙 관리 대시보드                        │
├─────────────────────────────────────────┤
│  [+ 새 규칙 생성]  [📥 정책에서 생성]     │
│                                         │
│  필터: [전체▾] [활성▾] [심각도▾] [🔍]    │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ ⚡ 비밀번호 90일 미변경 감지      │   │
│  │ 📄 정보보안 정책서 v5.1          │   │
│  │ 🔴 High │ 실시간 │ 23건 위반     │   │
│  │ [⚙️설정] [📊통계] [▶️실행] [⏸️일시정지] │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 🛡️ 관리자 권한 무단 접근 감지    │   │
│  │ 📄 접근권한 관리 규정 v1.2       │   │
│  │ 🔴 Critical │ 실시간 │ 3건 위반  │   │
│  │ [⚙️설정] [📊통계] [▶️실행] [⏸️일시정지] │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

#### 3.2 규칙 상세 뷰
```
┌───────────────────────────────────────────┐
│ 비밀번호 90일 미변경 감지                   │
├───────────────────────────────────────────┤
│ [기본 정보] [쿼리] [알림] [히스토리] [통계]  │
│                                           │
│ 기본 정보:                                 │
│   • 기반 정책: 정보보안 정책서 v5.1        │
│   • 데이터 소스: HR_Master_DB             │
│   • 심각도: High                          │
│   • 스케줄: 매일 09:00                     │
│   • 생성일: 2024-06-15                    │
│   • 마지막 수정: 2024-11-01               │
│                                           │
│ 쿼리:                                      │
│   SELECT user_id, name, last_password_change │
│   FROM users                               │
│   WHERE DATEDIFF(NOW(), last_password_change) > 90 │
│   [쿼리 테스트] [쿼리 최적화]               │
│                                           │
│ 알림 설정:                                 │
│   ✅ 이메일 (admin@company.com)           │
│   ✅ Slack (#security-alerts)             │
│   ✅ 대시보드 알림                         │
│                                           │
│ AI 제안:                                   │
│   💡 정책이 v5.2로 업데이트되었습니다.     │
│      비밀번호 변경 주기가 60일로 변경되었으니 │
│      규칙을 업데이트하시겠습니까?          │
│      [지금 업데이트] [나중에]              │
└───────────────────────────────────────────┘
```

#### 3.3 규칙 생성 마법사
```
┌─────────────────────────────────────────┐
│  새 규칙 생성                 [1/5 단계]   │
├─────────────────────────────────────────┤
│                                         │
│  1️⃣ 기반 정책 선택                       │
│  ┌─────────────────────────────────┐   │
│  │ 🔍 정책 검색...                  │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [✓] 정보보안 정책서 v5.1               │
│  [ ] 내부회계관리제도 운영규정 v3.2     │
│  [ ] ESG 경영 가이드라인 2024          │
│                                         │
│  또는                                   │
│  ┌─────────────────────────────────┐   │
│  │ 💬 자연어로 규칙 설명하기         │   │
│  │                                  │   │
│  │ 예: "퇴사자가 시스템에 접근하면   │   │
│  │      알림을 받고 싶어요"          │   │
│  └─────────────────────────────────┘   │
│                                         │
│              [취소]  [다음 →]           │
└─────────────────────────────────────────┘
```

---

### 4. 고급 기능

#### 4.1 규칙 템플릿
**사전 정의된 템플릿:**
- 비밀번호 정책 위반 감지
- 접근 권한 위반 감지
- 퇴사자 접근 감지
- 업무 시간 외 활동 감지
- 대용량 데이터 유출 감지
- 중복 지출 감지

**커스텀 템플릿 생성:**
- 자주 사용하는 규칙을 템플릿으로 저장
- 팀 내 공유 가능

#### 4.2 규칙 체인 (Rule Chain)
**연쇄 규칙 실행:**
```
규칙 A 위반 감지
    ↓
규칙 B 자동 실행 (심화 조사)
    ↓
규칙 C 실행 (조치 자동화)
```

**예시:**
1. "비정상 로그인 감지" → 위반 발견
2. "해당 사용자의 최근 활동 조회" → 자동 실행
3. "계정 임시 잠금" → 자동 조치

#### 4.3 규칙 시뮬레이션
**사전 테스트:**
- 규칙 생성 전 과거 데이터로 시뮬레이션
- 예상 위반 건수 및 False Positive 예측
- 성능 영향 분석

#### 4.4 규칙 버전 관리
**Git-like 버전 관리:**
- 모든 규칙 변경 이력 추적
- 이전 버전으로 롤백 가능
- 변경 사항 diff 확인

---

### 5. AI 기반 인텔리전스

#### 5.1 스마트 제안
- 정책 분석 후 생성 가능한 규칙 자동 제안
- 기존 규칙과의 중복 여부 검사
- 최적의 스케줄 및 심각도 제안

#### 5.2 이상 탐지
- 규칙 실행 패턴 학습
- 비정상적인 위반 급증 감지
- 규칙 자체의 오작동 감지

#### 5.3 자동 보고서 생성
- 주간/월간 규칙 실행 요약
- 위반 트렌드 분석
- 규칙 효과성 평가

---

## 🚀 구현 우선순위

### Phase 1 (핵심 기능)
1. ✅ 규칙 목록 표시
2. 규칙 상세 뷰 (쿼리, 설정, 통계)
3. 수동 규칙 생성 마법사
4. 규칙 활성화/비활성화
5. 규칙 삭제

### Phase 2 (자동화)
1. 정책 기반 자동 규칙 제안
2. 정책 변경 시 규칙 자동 업데이트 제안
3. 자연어 → SQL 자동 변환
4. 규칙 테스트 및 시뮬레이션

### Phase 3 (고급 기능)
1. 규칙 템플릿 시스템
2. 규칙 체인 (연쇄 실행)
3. 성능 모니터링 및 최적화
4. 규칙 버전 관리
5. 자동 보고서 생성

### Phase 4 (AI 강화)
1. 이상 탐지 (규칙 및 위반 패턴)
2. 자동 False Positive 필터링
3. 예측적 규칙 제안
4. 자연어 대화형 규칙 관리

---

## 🎨 UI/UX 개선 포인트

### 현재 문제점
- 규칙 카드가 정보 밀도가 낮음
- 규칙 수정/설정 UI 없음
- 규칙 생성 프로세스 부재
- 규칙과 정책의 연결 관계가 명확하지 않음

### 개선 방향
1. **규칙 카드 개선**
   - 실행 통계 추가 (성공률, 평균 위반 건수)
   - 마지막 실행 시간 표시
   - 빠른 액션 버튼 (설정, 실행, 일시정지)

2. **규칙 관리 페이지 독립**
   - 현재: 우측 패널의 한 탭
   - 개선: 독립된 전체 화면 뷰 옵션 제공

3. **시각화 강화**
   - 규칙-정책 관계도 (그래프)
   - 위반 트렌드 차트
   - 규칙 실행 타임라인

4. **드래그 앤 드롭**
   - 정책 문서를 규칙 생성 영역에 드롭하여 자동 생성
   - 규칙 우선순위 드래그로 조정

---

## 🔧 기술 스택 제안

### 규칙 엔진
- **Drools** (오픈소스 규칙 엔진)
- **Custom Python Engine** (유연성 최대화)

### 쿼리 생성
- **Text-to-SQL 모델** (GPT-4, CodeLLaMA)
- **SQLGlot** (쿼리 파싱 및 최적화)

### 스케줄링
- **APScheduler** (Python)
- **Celery + Redis** (분산 작업 큐)

### 모니터링
- **Prometheus** (메트릭 수집)
- **Grafana** (시각화)

---

## 📊 성공 지표 (KPI)

1. **규칙 생성 효율성**
   - 정책 1개당 자동 생성되는 규칙 수
   - 규칙 생성 소요 시간 (수동 vs 자동)

2. **규칙 정확도**
   - True Positive Rate
   - False Positive Rate
   - 사용자 승인률

3. **유지보수 효율성**
   - 정책 변경 후 규칙 업데이트까지 걸린 시간
   - 자동 업데이트 성공률

4. **시스템 성능**
   - 규칙 실행 평균 시간
   - 리소스 사용률 (CPU, 메모리)

---

## 🎯 다음 단계 액션

1. **즉시 시작:**
   - 규칙 상세 모달/패널 UI 구현
   - 규칙 생성 마법사 프로토타입

2. **이번 주:**
   - 자연어 → SQL 변환 프로토타입
   - 정책-규칙 연결 시각화

3. **다음 주:**
   - 규칙 템플릿 시스템 구현
   - 규칙 실행 시뮬레이션 기능

RuleX의 핵심 가치는 **"정책에서 규칙으로의 자동화된 전환"**입니다. 이를 중심으로 모든 기능을 설계하고 구현하면 됩니다.
